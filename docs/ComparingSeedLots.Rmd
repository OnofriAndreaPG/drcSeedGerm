---
title: "Comparing germination curves for different seed lots"
date: "17 July, 2019"
output:
  html_document:
    keep_md: no 
    toc: yes
    toc_float:
      collapsed: no
      smooth_scroll: no
---

---

```{r setup, cache = F, echo = F}
knitr::opts_chunk$set(echo = TRUE)
#Put at the beginning
knitr::knit_hooks$set(document = function(x){ 
  gsub("```\n*```r*\n*", "", x) 
})
```


#Introduction

Seed scientists are often concerned with several seed lots, which show different germination behaviours. For instance, they can have different plant species, or one single plant species  submitted to different treatments, e.g. different temperatures, different light conditions, different types of priming. One typical question is: how do I compare the germination behaviour of these different seed lots?

Let's take a practical approach and start from an appropriate example: we studied the germination behaviour for seeds of a plant species (*Verbascum arcturus*, BTW...), in different conditions. In detail, we considered the factorial combinations of two storage periods (LONG and SHORT storage) and two temperature regimes (FIX: constant daily temperature of 20°C; ALT: alternating daily temperature regime, with 25°C during daytime and 15°C during night time, with a 12:12h photoperiod). If you are not a seed scientist you may wonder why we made such an assay; well, there is evidence that, for some plant species, the germination ability improves over time after maturation. Furthermore, some seeds do not germinate well at a constant daily temperature regime, favouring daily temperature fluctuations.  These are all mechanisms by which seeds can recognise that they are in favourable conditions (e.g. they are close to the soil surface), so that the chances for plant establishment are maximised. Clever, isn't it?

But let's go back to our assay: we had four combinations (LONG-FIX, LONG-ALT, SHORT-FIX and SHORT-ALT) and four replicates for each combination. One replicate consisted of a Petri dish, that is a small plastic box containing humid blotting paper, where we put 25 seeds of Verbascum. In all, there were 16 Petri dishes: we put them in climatic chambers with the appropriate conditions and made daily inspections: germinated seeds were counted and removed from the dish. We did this for 15 days, until no more germinations could be observed.

The dataset is available from a gitHub repository: let's load it and have a look.

```{r}
dataset <- read.csv("https://raw.githubusercontent.com/OnofriAndreaPG/agroBioData/master/TempStorage.csv", header = T, check.names = F)
head(dataset)
```

We have one row per Petri dish; the first three columns show dish id, storage and temperature conditions. The next 15 columns represent the inspection times (from 1 to 15) and the counts of germinated seeds. The research question is:

*Is germination behaviour affected by storage and temperature conditions?*

# Response feature analyses

One possible line of attack is to take a summary measure for each dish, e.g. the total number of germinated seeds. Taking a single value for each dish brings us back to more common methods of data analysis: for example, we can fit some sort of GLM to test the significance of effects (storage, temperature and their interaction), within a fully factorial design.

Although the above method is not wrong, undoubtedly, it is sub-optimal. Indeed, dishes may contain the same total number of germinated seeds, but, nonetheless, they may differ for some other germination traits, such as velocity or uniformity. Clearly, we would like to express an overall judgment about the seed lots, not only about one charateristic of the seed lot. We are not specifically asking: "do the seed lots differ for their germination capability?". We are, more generally, asking "are the seed lots different?".

Therefore, a different method of analysis should be sought, which considers the entire time series (from 1 to 15 days) and not only one single summary measure. This method exists and it is available within the time-to-event platform, which has shown very useful and appropriate for seed germination studies (Onofri et al., 2011; Ritz et al., 2013; Onofri et al., 2019).

# The germination time-course

It is necessary to re-organise the dataset in a more useful way. A good format can be obtained by using the 'makeDrm()' function in the 'drcSeedGerm' package, which can be installed from gitHub (see the code at: [this link](https://www.statforbiology.com/seedgermination/index.html)). The function needs to receive a dataframe storing the counts (dataset[,4:18]), a dataframe storing the factor variables (dataset[,2:3]), a vector with the number of seeds in each Petri dish (rep(25, 16)) and a vector of monitoring times.

```{r}
library(drcSeedGerm)
datasetR <- makeDrm(dataset[,4:18], dataset[,2:3], rep(25, 16), 1:15)
head(datasetR, 16)
```

The snippet above shows the first dish. The column 'timeAf' contains the time when the inspection was made and the column 'count' contains the number of germinated seeds (e.g. 9 seeds were counted at day 9). These seeds did not germinate exactly at day 9; they germinated within the interval between two inspections, that is between day 8 and day 9. The beginning of the interval is given in the variable 'timeBef'. The cumulative counts of germinated seeds are in the column 'nCum'; these cumulative counts have been converted into cumulative proportions by dividing by 25 (i.e., the total number of seeds in a dish; see the column 'propCum').

We can use a time-to-event model to parameterise the germination time-course for this dish. This is easily done by using the 'drm()' function in the 'drc' package (Ritz et al., 2013):

```{r}
modPre <- drm(count ~ timeBef + timeAf, fct = LL.3(), data = datasetR,
  type = "event", subset = c(Dish == 1))
plot(modPre, log = "")
```

Please, note the following:

1. we are using the counts ('count') as the dependent variable
2. as the independent variable: we are using the extremes of the inspection interval, within which germinations were observed (~ timeBef + time Af)
3. we have assumed a log-logistic distribution of germination times (fct = LL.3()). A three parameter model is necessary, because there is a final fraction of ungerminated seeds (truncated distribution)
4. we have set the argument 'type = "event"'. Indeed, we are fitting a time-to-event model, not a nonlinear regression model, which would be incorrect, in this setting (see [this link here](https://www.statforbiology.com/seedgermination/timetoevent) ).

As we have determined the germination time-course for dish 1, we can do the same for all dishes. However, we have to instruct 'drm()' to define a different curve for each combination of storage and temperature. It is necessary to make an appropriate use of the 'curveid' argument. Please, see below.

```{r}
mod1 <- drm(count ~ timeBef + timeAf, fct = LL.3(), data = datasetR,
  type = "event", curveid = Temp:Storage)
plot(mod1, log = "", legendPos = c(2, 1))
```

It appears that there are visible differences between the curves (the legend considers the curves in alphabetical order, i.e. 1: Fix-Low, 2: Fix-High, 3: Alt-Low and 4: Alt-High). We can test that the curves are similar by coding a reduced model, where we have only one pooled curve for all treatment levels. It is enough to remove the 'curveid' argument.

```{r}
modNull <- drm(count ~ timeBef + timeAf, fct = LL.3(), data = datasetR,
  type = "event")
anova(mod1, modNull, test = "Chisq")
```

Now we can compare the full model (four curves) with the reduced model (one common curve) by using a Likelihood Ratio Test, which is approximately distributed as a Chi-square. The test is highly significant. Of course, we can also test some other hypotheses. For example, we can code a model with different curves for storage times, assuming that the effect of temperature is irrelevant:

```{r}
mod2 <- drm(count ~ timeBef + timeAf, fct = LL.3(), data = datasetR,
  type = "event", curveid = Storage)
anova(mod1, mod2, test = "Chisq")
```

We see that the effect of temperature is significant. Similarly, we can test the effect of storage:

```{r}
mod3 <- drm(count ~ timeBef + timeAf, fct = LL.3(), data = datasetR,
  type = "event", curveid = Temp)
anova(mod1, mod3, test = "Chisq")
```

Again, we get significant results. It is necessary to mention that the above LR tests are approximate, although we get very low p-levels, which leave us very confident about the significance of effects. If we are not particularly concerned with p-levels, we can also compare models by using the Akaike Information Criterion (AIC: the lowest is the best), which confirms that the complete model with four curves is indeed the best one.

```{r}
AIC(mod1, mod2, mod3, modNull)
```


For those who are familiar with linear model parameterisation, it is possible to reach even a higher degree of flexibility by using the 'pmodels' argument, within the 'drm()' function. However, this will require another post. Thanks for reading!

# References

1. Onofri, A., Mesgaran, M.B., Tei, F., Cousens, R.D., 2011. The cure model: an improved way to describe seed germination? Weed Research 51, 516–524.
2. Onofri, A., Piepho, H.-P., Kozak, M., 2019. Analysing censored data in agricultural research: A review with examples and software tips. Annals of Applied Biology 174, 3–13. https://doi.org/10.1111/aab.12477
3. Ritz, C., Pipper, C.B., Streibig, J.C., 2013. Analysis of germination data from agricultural experiments. European Journal of Agronomy 45, 1–6.


