---
title: "Seed germination: time-to-event methods account for censoring"
csl: european-journal-of-agronomy.csl
date: "17 December, 2018"
output:
  html_document:
    keep_md: no
    toc: no
    toc_float:
      collapsed: no
      smooth_scroll: no
bibliography: drcSeedGerm.bib
---

```{r setup, cache = F, echo = F}
#Put at the beginning
knitr::knit_hooks$set(document = function(x){ 
  gsub("```\n*```r*\n*", "", x) 
})
```

---

# Introduction

Seed germination data are characterised by a peculiar source of uncertainty, that is know as 'censoring'. Due to the monitoring schedule, we are not able to record the exact germination time of each seed in the lot; we are only able to record that germination took place within a certain interval of time. If you would like to know more about censoring, you can find further information [in this page here](Censoring.html). In that page, we have also shown that neglecting censoring during data analyses may lead to unreliable results. The question is: "how do we account for censoring?".

There is indeed a class of models that are specifically devised to account for all types of censoring. These models have been largely used in medicine to describe the time to death or other events of interest. This body of methods usually goes under the name of survival analyses, but we'd preferably talk about time-to-events methods. We have extensively talked about these models and how they account for censoring in two of our recent papers and related appendices [@onofri_analysing_2019; @onofri_hydrothermal-time_2018]. Therefore, we will not go into detail, now. We think that the readers want to be mainly convinced that fitting these models is as easy as fitting traditional models, with a clear gain in terms of reliability and efficiency.

# A Monte Carlo simulation

In our previous page about censoring we ideally took a seed population, with log-normal distribution of germination time, location parameter $e = 4.5$ days, scale parameter $b = 0.6$  and a maximum germinated proportion $d = 0.85$. For this population, the time to 50% germination (T50) was 5.14 days and the Mean Germination Time (MGT) was 5.39 days. We took a sample of 100 seeds from that population, by using Monte Carlo simulation. For the ease of reading, we replicate the simulation here.



```{r}
#Real parameter values
e <- 4.5; b <- 0.6; d = 0.85

#Monte Carlo simulation - Step 1
#Simulating the number of germinated seeds
#out of the 100 tesetd
set.seed(1234)
nGerm <- rbinom(1, 100, d)
nGerm

#Monte Carlo simulation - Step 2
#Simulating the germination time for each seed in the sample
Gtimes <- rlnorm(nGerm, log(e), b)
Gtimes <- c(Gtimes, rep(Inf, 100 - nGerm))
Gtimes

#Monte carlo simulation - Step 3
#Simulating the observed counts
obsT <- seq(1, 15, by=1) #Observation schedule
table( cut(Gtimes, breaks = c(0, obsT)) )

counts <- as.numeric( table( cut(Gtimes, breaks = c(0, obsT)) ) )
```

Time-to-event methods directly consider the observed counts as the response variable. As the independent variable, they consider both the extremes of each time interval (timeBef and timeAf; see below). The dataset is organised as follows:

```{r}
timeBef <-  c(0, obsT)
timeAf <- c(obsT, Inf)
Counts <- c(counts, 100 - sum(counts))
df <- data.frame(timeBef, timeAf, Counts)
df
```


The organisation is clear: we see that we had, e.g., 8 seeds germinated between timeBef = 1 and timeAf = 2 and 9 seeds germinated between timeBef = 2 and timeAf = 3. Please, also note that there are 14 seeds with a germination time higher than 15 days (right censoring); they include both the dormant seeds (that were non-germinable) and the germinable seeds with a germination time higher than 15 days. It should be clear that the dataset above includes all forms of uncertainty due to censoring.

If we compare the model definition, nonlinear regression analysis would use the following statement:

```
CumulativeProportion ~ timeAf
```

On the other hand, a time-to-event model is defined as:

```
Count ~ timeBef + timeAf
```
In order to fit a time-to-event model with log-normal distribution of germination time, we use the fallowing call (please note the argument 'type', which is set to 'event'):

```{r message=F}
library(drc)
#Time-to-event model
modTE <- drm(Counts ~ timeBef + timeAf, data = df, 
           fct = LN.3(), type = "event")
summary(modTE)

#Nonlinear regression model
propCum <- I(cumsum(df$Counts)/100)
modNL <- drm(propCum ~ timeAf, data = df, 
           fct = LN.3(), subset=is.finite(df$timeAf)==T)
summary(modNL)
```

Please consider that the function 'LN.3()' is parameterised by using a scale parameter $b$, that is the inverse of the value which we used for the simulatyion. Indeed, model fit returns an estimate of 1.9, which is approximately equal to $1/0.6$, at the net of sampling error.

With respect to a nonlinear regression fit, the estimate of 'e' is very close, but the standard error is higher. Let's compare the two methods with 1000 samples (be patient... it may take a while)

```{r}
GermSampling <- function(nSeeds, timeLast, stepOss, mu, shape, pMax){
    
    #Draw a sample as above
    germ <- rbinom(1, nSeeds, d)
    Gtimes <- rlnorm(nGerm, log(e), b)
    Gtimes <- c(Gtimes, rep(Inf, 100 - nGerm))
    
    #Generate the observed data
    obsT <- seq(1, timeLast, by=stepOss) #Observation schedule (by 5 o 2)
    counts <- as.numeric( table( cut(Gtimes, breaks = c(0, obsT)) ) )
    propCum <- cumsum(counts)/nSeeds
    timeBef <- c(0, obsT)
    timeAf <- c(obsT, Inf)
    counts <- c(counts, nSeeds - sum(counts))
    
    #Calculate the T50 with two methods
    mod <- drm(propCum ~ obsT, fct = LN.3() )
    modTE <- drm(counts ~ timeBef + timeAf, 
           fct = LN.3(), type = "event")
    c(T501 = summary(mod)[[3]][3,1],
         ES1 = summary(mod)[[3]][3,2],
         T502 = summary(modTE)[[3]][3,1],
         ES2 = summary(modTE)[[3]][3,2] )
}

set.seed(1234)
result <- data.frame()
for (i in 1:1000) {
  res <- GermSampling(100, 15, 1, 4.5, 0.6, 0.85)
  result <- rbind(result, res)
} 
names(result) <- c("T501", "ES1", "T502", "ES2")
apply(result, 2, mean)
apply(result, 2, sd)
```

We see that both methods lead to unbiased estimates. However, the sampling distribution of T50 shows a standard deviation of approximately 0.34 days. This is estimated correctely by the time-to-event method, which, on average, leads to an estimate of 0.33 days. On the contrary, nonlinear regression leads to an average estimate of 0.09, that is almost one fourth of the real value.

#Take-home message

Censoring is peculiar to germination assays and other time-to-event studies. It may have a strong impact on the reliability of our estimates and standard errors and, therefore, it should never be neglected. The best way not to neglect it is to use time-to-event methods to estimate the germination curve, while avoiding traditional non-linear regression. 



# References
